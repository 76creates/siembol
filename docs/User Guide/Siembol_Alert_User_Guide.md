# Siembol Alert User Guide
## Overview
Siembol Alert is a detection engine used to filter matching events from an incoming data stream based on a configurable rule set. Rules can be built, modified, and tested through the Siembol UI.

Rules are JSON configs generated by the UI. The raw JSON can be viewed through the UI as necessary or can be seen in the store repo for Siembol Alert. 

## Accessing the UI
From the Siembol home page, click the alert manager button to load the alert manager interface

![alert manager button](images/alert/alert_manager_button.PNG)

## Alert Manager UI
The Alert Manager UI is split into two sections. On the left hand side you can see all rules which are stored in Siembol Alert. On the right hand side you can see all the rules which are deployed. Rules which are deployed still show up in the store section.


 [//]: # (TODO add image of store/deploy)

This changes the view to the alert rule editor mode.

### Alert rule editor UI - Tabs
There are 3 different tabs in the alert rule editor UI: 
- Edit config: allows you to edit the rule to make it alert as you require
- Test config: allows you to provide a raw event to test your rule works as expected. It also allows you to see the output from the event parsing through Siembol Alert. These tests are not persistent and just provide point in time verification that the alert works for a specific alert
- Test cases: allows you right persistent tests to verify the rule works.

[//]: # (TODO show tabs alert rule editor UI)

### Alert rule editor UI - Edit Config
At the top there is a text input that allows you to provide a name for a rule - use a descriptive name to make it easier to identify later in the pipeline.

[//]: # (TODO add image for the config name)

There are 5 different tabs within the edit config UI:

#### Rule Description
This section contains a single text input that allows you set a description for the alert. This should be a short helpful comment that allows anyone to identify the purpose of this alert.

[//]: # (TODO add image of rule description)

#### Source Type
This section allows you to determine the type of data you want to match on. It is essentially a matcher for the "source_type" field. This field does not support regex - however using * as an input matches all source types.

The source_type field is set during parsing and is equal to the name of the parser config which was used to parse the event.

[//]: # (TODO add image of sourcetype)

```
Tip: if you want to match on multiple data sources, set the source type to be * and add a regex matcher (in the matcher section) to filter down to your desired source types.
```

#### Matchers
Matchers allow you to select the events you want the rule to alert on.

To add a matcher, click the Add to Matchers button:

[//]: # (TODO add image of add to matchers button)

You can add as many matchers as you want.

There are two types of matchers:

##### 1) REGEX_MATCH matcher
A regex_match allows you use a regex statement to match a specified field. There are two string inputs:
- Field: the name of the field to compare to the regex statement
- Data: the regex statement 

There is a "is negated" checkbox - this means that if the regex statement doesn't match the value of the field then the matcher will return true.

Named capture groups in the regex are added as fields in the event. They are available from the next matcher onwards and are included in the output event.

Siembol uses Java regex, for support on how to write this see the Java Documentation here: [Java Regular Expressions](https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html)

[//]: # (TODO add image of regex matcher)

##### 2) IS_IN_SET matcher
An "is_in_set" matcher compares the value of a field to a set of strings, if the value is in the set then the matcher returns true.
There are also two string inputs for this type of matcher:
- Field: the name of the field to compare with
- Data: A list of strings to compare the value to. New line delimited. Does not support regex - each line must be a literal match however, field substitution is supported in this field.  

The "is_negated" checkbox is the same as for the regex_matcher.
The "case_insensitive" checkbox means that the case of the strings in the data field is ignored.

[//]: # (TODO add image of is_in_set matcher)

#### Tags
Tags are optional but recommended as they allow you categorise your rules.

To add a tag, click the Add to Tags button:

[//]: # (TODO add image of "add to tags button")

Each tag is a key-value pair. Both the key and value inputs are completely free allowing you to tag your rules in the way which works best for your organisation.

You can use substitution in the value input to set the tag value equal to the value of a field from the event. The syntax for this is `{field_name}` eg:

[//]: # (TODO add image of substitution in tag value)

#### Rule Protection
Rule protection allows you to prevent a noisy alert from flooding the components downstream. You can set the maximum number of times an alert can fire per hour and per day. If either limit is exceeded then any event that matches is filtered and not sent on to Siembol Response until the threshold is reset.

This section is optional - if it isn't configured for a rule, the rule will get the global defualts applied (these are set during the deployment process - see below).

[//]: # (TODO add image of rule procetion page)

### Alert rule editor UI - Test Config
The use of the test config UI is covered in the Test_Config_User_Guide.

[//]: # (TODO add link to test config guide)

### Alert rule editor UI - Test Cases
The use of a test cases UI is covered in the Test_Cases_User_Guide.

[//]: # (TODO add link to test cases guide)

### Saving a config
You can save the config at any time (provided the config is valid) by clicking the submit button found in the edit config tab. This will commit it to the the store.

[//]: # (TODO add image of the submit button)

## Deploying a config - Siembol Alert specfic options
When you click the deploy button in the alert manager UI you are presented with a box which allows you to set two things:

[//]: # (TODO add image of deploy options)

### Global tags
You can add tags in the same way as you would for an individual rule. Clicking the "Add to Tags" button allows you to set the key and value fields for the rules. This tag is applied to all rules which are being deployed.

Adding global tags is optional.

[//]: # (TODO add image of global tags)

### Global rule protection
Setting the global rule protection limits is mandatory. These protections will apply to any rule which doesn't have rule protections configured already. See the Rule Protection section above for more details

Once both of these sections are complete, you can press validate to ensure all of your rules are complete and free from syntax errors. Provided all validations pass, you can then press Deploy to create the pull request with the release repo. 
