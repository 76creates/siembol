<div class="console">
    <span class="title">
        <h4>
            <mat-icon class="left-icon">computer</mat-icon>Test Output
        </h4>
        <h4 *ngIf="output.test_result_raw_output" class="output-help">Click the JSON key to copy the absolute JSON path to clipboard</h4>
    </span>
    <div class="json-tree" *ngIf="output.test_result_raw_output">
        <re-json-tree [json]="output.test_result_raw_output || {}" [prevKey]="'$'"></re-json-tree>
    </div>
    <mat-expansion-panel [expanded]="output.message">
        <mat-expansion-panel-header>
            <mat-panel-title>
                Output Messages
            </mat-panel-title>
        </mat-expansion-panel-header>
        <div *ngIf="output.message">
            <pre>{{ output.message }}</pre>
        </div>
        <div *ngIf="output.exception">
            <pre>{{ output.exception }}</pre>
        </div>
        <div *ngIf="output.test_result_raw_output">
            <pre>{{ output.test_result_output }}</pre>
        </div>
    </mat-expansion-panel>
</div>

<div class="button-group-end">
    <a mat-button color="none" [routerLink]="['/help/testcase']" target="_blank"><mat-icon>help_outline</mat-icon></a>
    <button mat-raised-button color="accent" title="Test Config" [disabled]="!(form.valid && !isNewTestCase)" (click)="testConfig.emit(formatOutput())">Test Config<mat-icon>play_arrow</mat-icon></button>
    <button mat-raised-button color="accent" title="Run Test Case" [disabled]="!(form.valid && !isNewTestCase)" (click)="runTestCase.emit(formatOutput())">Run Test Case<mat-icon>play_arrow</mat-icon></button>
</div>

<form [formGroup]="form">
    <formly-form #formly immutable [model]="testCase" [fields]="fields" [options]="options" [form]="form" (modelChange)="updateOutput($event)"></formly-form>
</form>

<div mat-dialog-actions class="button-group-end">
    <button mat-raised-button color="accent" [disabled]="!form.valid" (click)="submittedTest.emit(formatOutput())">Save Test Case</button>
    <button mat-raised-button (click)="cancel.emit(false)">Cancel</button>
</div>